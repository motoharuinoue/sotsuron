¥chapter{マニュアルからの漫画生成支援システム}

¥section{提案システムの概要}

¥subsection{事前処理}

システムを使用するにあたり，ユーザは事前にマニュアルのPDFファイルをシステムに入力できる形式に変換しておく必要がある．具体的には，漫画にしたいマニュアルのPDFファイルからテキストと画像を別々に取り出しておく．

¥subsection{システムの流れ}

¥begin{figure}[tb]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/system.eps}
  ¥caption{システムの流れ}
  ¥label{fig:system}
 ¥end{center}
¥end{figure}

図¥ref{fig:system}に提案するシステムの流れを示す．提案システムの流れは以下のようになっている．まず，ユーザがPDFファイルからテキストと画像を取り出し，以下の3つを選択する．
¥begin{itemize}
¥item Step1　漫画化するファイルを選択¥¥
製品別のフォルダ内にページごとに分かれているテキストファイルから，漫画化する対象のマニュアルを選択する．
¥item Step2　漫画で使用する文と画像を選択¥¥
選択したテキストファイルの中から，さらに漫画で使用する文を選択する．同時に，文と一緒に漫画のコマに入れたい画像を文に対応付けられた候補画像の中から選択する．
¥item Step3　フォントサイズと文体を選択¥¥
3種類のフォントサイズ(大，中，小)と2種類の文体(ですます，話し言葉)から，漫画のセリフに適用したい要素をそれぞれ選択する．
¥end{itemize}

ユーザの選択に応じて，次にシステムによって以下の処理が行われる．
¥begin{itemize}
¥item Step4　1つのコマに使用する文の選択¥¥
Step2で選択された文に対し，短い文については前後の文との結合を行い文の数を削減する．それぞれのコマの種類を決定し，処理を行った文を1コマに1文ずつ対応付ける．
¥item Step5　選択された文体への変換¥¥
選択された文体に応じて，Step4の各文に対して文末の変換処理を行う．
¥item Step6　行単位への分割¥¥
文を吹き出し内の領域に収めるために，改行位置の決定と行数の削減を行う．
¥item Step7　要素の決定¥¥
漫画の要素(背景，キャラクターのポーズと表情，吹き出し，男の子の相槌)の決定を行う．
¥item Step8　漫画生成¥¥
選択した漫画の要素と処理を行った文をコマに配置して漫画を生成する．
¥item Step9　漫画出力¥¥
生成した漫画が出力される．
¥end{itemize}

事前処理を行った上で，Step1〜Step9の流れによりマニュアルが漫画形式に変換されて出力される．Step1〜Step3はユーザが行う処理，Step4〜Step9はシステムが行う処理である．次節より，それぞれの手順について詳しく説明する．

¥section{ユーザ操作}

¥subsection{テキスト，画像の取り出し}

¥begin{figure}[tb]
 ¥begin{center}
  ¥includegraphics[scale=0.6]{./fig/txtPict.eps}
  ¥caption{PDFからテキストファイルと画像を取り出す}
  ¥label{fig:txtPict}
 ¥end{center}
¥end{figure}

一般に，家電製品のマニュアルはPDF形式で電子配布されていることが多い．また，製品に付属している紙のマニュアルもスキャンすることでPDFファイルに変換できる．本システムを使用するためには，そのようなPDF形式のマニュアルから手動でテキストファイルと画像の取り出しを行っておく必要がある．¥¥
　図¥ref{fig:txtPict}にマニュアルのPDFファイルとそれから作成したテキストファイル，取り出した画像の例を示す．マニュアルは分量が多いため，基本的な操作の部分のみを項目(例：洗濯機における「洗濯・乾燥の流れ」)ごとに分けてテキストファイルを作成する．マニュアルでは1項目が1〜2ページに渡って書かれていることが多いので，PDFファイルの1〜2ページ分を1つのテキストファイルとして保存する．つまり，1つのPDFファイルからユーザは複数のテキストファイルを作成することになる．¥¥
　また，テキストファイルの作成と同時にユーザは画像の取り出しも行う必要がある．マニュアルの画像は手順に対応して貼り付けられていることが多い．そのため，対応する手順番号を取り出した画像のファイル名とすることにより，文と画像の対応付けを実現している．すなわち，1つのテキストファイルには複数の画像が対応付けられることになる．

¥subsection{ユーザフォルダの作成}

システムを使用する際に，ユーザはまずユーザ名の入力を求められる．これは，それぞれのユーザを区別して各ユーザが作成した漫画を保存しておくことを目的としている．ユーザ名が入力されると，その名前のフォルダが作成され，そこにそのユーザがそれまでに生成した漫画が自動で保存される．ユーザフォルダには生成回数ごとにフォルダが作成され，そこには以下の4種類のデータが保存される．
¥begin{itemize}
¥setlength{¥itemsep}{-5pt}
¥item コマ
¥item コマを4枚組み合わせた4コマ漫画(1ページの1/2にあたる)
¥item 4コマ漫画を2枚組み合わせた8コマ漫画(1ページにあたる)
¥item すべてのコマをまとめた1枚の漫画
¥end{itemize}

また，ユーザが漫画を生成した回数は，システムが自動でテキストファイルに書き込むことによって保存される．そのため1度システムを終了しても，テキストファイルに保存された前回までの生成回数を読み込むことにより，新たに生成した漫画を前回の生成結果の続きに保存することが可能である．以上により，ユーザは複数回生成した漫画を比較検討することができるため，より自分の望むものに近い漫画が生成できると考えられる．

¥newpage

¥section{インタフェース}

¥subsection{漫画化するファイルの選択}

図¥ref{fig:system1}に漫画化するファイルの選択画面を示す．
¥begin{figure}[!b]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/system1.eps}
  ¥caption{漫画化するファイルの選択画面}
  ¥label{fig:system1}
 ¥end{center}
¥end{figure}

¥begin{enumerate}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item フォルダの選択ボタン¥¥
　マニュアルから作成したテキストファイルは製品ごとのフォルダに保存されている．ユーザは初めにマニュアルを漫画化する製品のフォルダを選択する．
¥item 選択したフォルダ内のテキストファイルの一覧を表示¥¥
　テキストファイルは項目ごとに分かれている．フォルダ選択後，その中で漫画にしたい項目のテキストファイルを選択する．
¥item 選択したテキストファイルの内容を表示¥¥
　どのような内容のマニュアルか確認することが可能である．
¥item 内容の選択ボタン¥¥
　漫画で使用する文と画像の選択画面に移動する．
¥end{enumerate}

¥subsection{漫画で使用する文と画像の選択}

図¥ref{fig:system2}に文と画像の選択画面を示す．
¥begin{figure}[!b]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/system2.eps}
  ¥caption{文と画像の選択画面}
  ¥label{fig:system2}
 ¥end{center}
¥end{figure}

¥begin{enumerate}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item 漫画で使用する文を選択¥¥
　{¥bf 3.3.1}で選択したテキストファイル内の文が画面上に10文ずつ表示される．ユーザは漫画にしたい文をチェックボックスにより選択する．
¥item 候補画像を表示¥¥
　表示している10文に対応付けられている画像を文に対する候補画像として表示する．画像をより詳細に見たい場合には，画像をクリックすることで拡大した画像を別ウィンドウで見ることができる．ユーザは画像の内容を確認しながら選択を行うことが可能である．
¥item 選択した文について，コマに加えたい画像を選択¥¥
　選択した文に対応する画像が存在する場合，文と同じコマに画像を追加することが可能である．文と一緒にコマに入れたい画像は，候補画像の中から1枚のみ選択できる．このとき，¥textcircled{¥scriptsize 1}で未選択の文については画像の選択を行うことはできない．
¥end{enumerate}

¥subsection{フォントサイズ，文体の選択}

図¥ref{fig:system3}にフォントサイズ，文体の選択画面を示す．
¥begin{figure}[tb]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/system3.eps}
  ¥caption{フォントサイズ，文体の選択画面}
  ¥label{fig:system3}
 ¥end{center}
¥end{figure}

¥begin{enumerate}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item フォントサ
　3種類のフォントサイズ(大，中，小)，2種類の文体(ですます，話し言葉)から，ユーザはラジオボタンにより好みのものを選択できる． 
¥item 生成ボタン¥¥
　生成ボタンを押すと，ダイアログにより選択したファイルとフォントサイズ，文体の確認が行われ，漫画が生成される．
¥end{enumerate}

¥subsection{漫画表示}

図¥ref{fig:system4}に漫画表示画面を示す．
¥begin{figure}[tb]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/system4.eps}
  ¥caption{漫画表示画面}
  ¥label{fig:system4}
 ¥end{center}
¥end{figure}

¥begin{enumerate}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item 生成漫画の表示部分¥¥
　生成した漫画は，8コマを1ページとしてページ単位でシステム上に表示する．漫画の生成が完了すると，タイトルコマから始まる1ページ目の画像が画面上に表示される．
¥item ページ送り機能¥¥
　生成した漫画のコマ数が8コマより多い場合，漫画は複数のページに分割されて生成される．画面上には1回に1ページのみ表示し，「前へ」「次へ」ボタンでページ送りを行うことで前後のページを見ることが可能である．
¥item コマの拡大機能¥¥
　8コマを1ページとしてシステム上に表示するため，それぞれのコマが小さくてよく見えず詳細を見たい場合があると考えられる．詳細を見たいコマに対応した漫画の右下の1〜8のボタンを押すことにより，コマ画像が別ウィンドウで拡大表示される．
¥item リセットボタン¥¥
　リセットボタンを押すと，生成した漫画は非表示になり漫画化するファイルの選択画面に戻る．
¥item 生成ボタン¥¥
　再び生成ボタンを押すと，同じ条件で漫画を再生成することができる．
¥item 全体表示ボタン¥¥
　全体表示ボタンを押すと，複数枚に分割されたすべてのページを1枚の漫画としてまとめた画像を別ウィンドウで表示する．これにより，ユーザは生成した漫画の全体像を見ることが可能である．
¥end{enumerate}

¥section{漫画の自動生成}

¥subsection{漫画内のコマのパターン}

図¥ref{fig:pattern}に漫画内のコマのパターンの例を示す．¥¥

¥begin{figure}[h]
 ¥begin{center}
  ¥includegraphics[scale=0.6]{./fig/pattern.eps}
  ¥caption{漫画内のコマのパターン}
  ¥label{fig:pattern}
 ¥end{center}
¥end{figure}

¥newpage

漫画内のコマのパターンは以下の4つの部分に分けて作成した．
¥begin{enumerate}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item タイトルコマ(1コマ目)¥¥
　マニュアルから作成したテキストファイルの1行目にはタイトルの文字列が入っている．テキストファイルの1行目の文字列を表示したコマをタイトルのコマとして1コマ目に割り当てる．
¥item 導入コマ(2コマ目)¥¥
　2コマ目には，タイトルの文字列を利用して作成した漫画の導入のコマを割り当てる．タイトルの文字列に「〜について説明します」「〜について説明するよ」などを結合することで導入の文を生成する．
¥item 説明コマ(3コマ目〜最後から2コマ目)¥¥
　漫画の中心部分となる説明コマについては次項で説明する． 
¥item まとめコマ(最後の1コマ)¥¥
　最後のまとめとなるコマは，マニュアルの内容によらずあらかじめ用意したテンプレートから文を選択して生成する．女の子のキャラクターと男の子のキャラクターのそれぞれに対してテンプレートを作成し，その中からランダムに文を選択して作成したコマをまとめのコマとして最後に割り当てる．女の子のキャラクターのテンプレートの例としては「以上で説明は終わりです」「これで説明は終わりだよ」など，男の子のキャラクターのテンプレートの例としては「説明してくれてありがとう！」「よくわかったよ！やってみるね！」などが挙げられる．
¥end{enumerate}

¥newpage

¥subsection{コマの種類}

コマの種類として以下の4種類のパターンを用意した．図¥ref{fig:frame}に4種類のコマの例を示す．
¥begin{enumerate}
¥setlength{¥itemsep}{-5pt}
¥renewcommand{¥labelenumi}{¥textcircled{¥scriptsize ¥theenumi}}
¥item 登場人物2人と，吹き出し1つ(女の子)
¥item 登場人物2人と，吹き出し2つ
¥item 登場人物1人(女の子)，吹き出し1つと画像1枚
¥item 吹き出し1つと画像1枚
¥end{enumerate}

¥begin{figure}[htbp]
 ¥begin{minipage}{0.5¥hsize}
  ¥begin{center}
   ¥includegraphics[scale=0.4]{./fig/frame.jpg}
  ¥end{center}
  ¥caption{コマの種類}
  ¥label{fig:frame}
 ¥end{minipage}
 ¥begin{minipage}{0.5¥hsize}
  ¥begin{center}
   ¥includegraphics[scale=0.4]{./fig/title.eps}
  ¥end{center}
  ¥caption{タイトルのコマ}
  ¥label{fig:title}
 ¥end{minipage}
¥end{figure}
キャラクターや吹き出し，画像の有無などを考慮し，また生成4ref{fig:title}にタイトルのコマの例を示す．¥¥
　ユーザによって選択された文に対して次節のテキスト解析を行った後，コマの種類の決定を行う．漫画の中心部分である3コマ目〜最後から2コマ目の説明コマについては，画像が選択されている文には¥textcircled{¥scriptsize 3}か¥textcircled{¥scriptsize 4}のコマを，画像が選択されていない文には¥textcircled{¥scriptsize 1}か¥textcircled{¥scriptsize 2}のコマをランダムに割り当てる．導入コマには¥textcircled{¥scriptsize 1}，まとめコマには¥textcircled{¥scriptsize 2}を割り当てる．¥¥

¥subsection{コマ内の文の調整}

¥renewcommand{¥thesubsubsection}{¥alph{subsubsection}}

¥subsubsection{手順番号の追加}

マニュアルでは手順が入れ子になっていることが多い．その場合，マニュアル上では手順番号に使われる記号の区別やインデントなどにより全体における手順の位置の把握が可能である．しかし，そのような文をそのまま漫画にしてしまうと，ユーザは自分が今読んでいるコマの手順が全体のどこに位置しているのかわからなくなってしまう可能性がある．¥¥
　そこで提案システムでは，入れ子になっている手順に対してそれが含まれる手順の番号を追加することにより，ユーザがマニュアル全体の構造を把握できるようにしている．PDFファイルからテキストファイルを作成する際，最も外側の手順番号は全角数字で，入れ子になっている手順番号は半角数字で表記しておく．漫画に文を貼り付ける際には，文頭の半角数字，すなわち入れ子になっている手順番号に対して文頭に「(その文が含まれる手順の番号)＋''--''」を追加する．¥¥
　図¥ref{fig:add\_num}に手順番号の追加の例を示す．例えば3番目の手順中の2番目の手順の文については，文頭の「2」を「3-2」に変更する．この処理により，文を漫画にしてもユーザは手順の構造を明確に把握することが可能となる．

¥begin{figure}[h]
 ¥begin{center}
  ¥includegraphics[scale=0.6]{./fig/add\_num.eps}
  ¥caption{手順番号の追加}
  ¥label{fig:add\_num}
 ¥end{center}
¥end{figure}

¥subsubsection{1つのコマに使用する文の選択}

文をコマに対応付ける際，基本的にはユーザによって選択された文を1文ずつ1つのコマに対応させれば良いと考えられる．しかしながら，1文の長さが極端に短い場合には，1文を1つのコマに対応付けてしまうとコマの数ばかりが増えてしまい冗長になる可能性がある．このような場合，なかなか内容が進まず読者にとって読みづらい漫画となってしまうことが考えられる．¥¥
　そこで提案システムでは，以下のルールに沿ってコマ内の文を調整する処理が行われる．

¥begin{enumerate}
¥item (対象の文が手順の最初の文である) or (次の文が手順の最初の文である)場合，次の文との結合は行わない¥¥
　手順の最初の文とは，文の頭が手順番号で始まる文のことである．マニュアルにおいては，手順の最初の文は手順内容を簡潔に示しており，その他の文は手順内容の補足説明をしていることが多い．そのため，手順の最初の文を次の文と結合すると手順の内容が分かりづらくなってしまう可能性がある．よって，手順の最初の文は次の文との結合を行わない．
¥item 次の文が記号(●)で始まる場合，次の文との結合は行わない¥¥
　次の文との結合を行うと文が理解しづらくなってしまうと考えられるため，結合は行わない．
¥item 次の文に画像が対応付けられている場合，次の文との結合は行わない¥¥
　次の文に画像が対応付けられている場合，次の文との結合を行うと画像の対応がずれてしまう．そのため，結合は行わない．
¥item 1文の文字数が2文続けてしきい値よりも少ない場合，2文を結合する¥¥
　吹き出しの最大文字数の1/2をしきい値として，1文の文字数が2文続けてしきい値よりも少ない場合に2文を結合する．吹き出しの最大文字数は，女の子のキャラクターについては1行に8文字×6行，男の子のキャラクターについては1行に6文字×3行と定めている．また，文を結合する際には1つ目の文に対して構文解析を行い，以下のルールで文を結合する．構文解析には，形態素解析器MeCab¥cite{mecab}と構文解析器CaboCha¥cite{cabocha}を使用した．
  ¥begin{enumerate}
  ¥item 1つ目の文の文末が動詞であった場合¥¥
  文末を「(文末の動詞の連用形)＋(、)」に変換して2つ目の文と結合．
  ¥item 1つ目の文の文末が名詞であった場合
    ¥begin{itemize}
    ¥item 1つ目の文の文末が「〜とき」¥¥
    そのまま2つ目の文と結合．
     ¥item 1つ目の文の文末の名詞の品詞再分類1が「一般」¥¥
    文末を「(文末の名詞)＋で」に変換して2つ目の文と結合．
    ¥item 1つ目の文の文末の名詞の品詞再分類1が「一般」以外¥¥
    文末を「(文末の名詞)＋をして」に変換して2つ目の文と結合．
    ¥end{itemize}
  ¥end{enumerate}
¥end{enumerate}

¥begin{table}[!b]
¥begin{center}
¥caption{文の結合の例}
¥label{layout2}
¥begin{tabular}{|l|c|c|c|l|}
¥hline
¥multicolumn{1}{|c|}{入力文} & 文字数 & 画像 & 結合 & ¥multicolumn{1}{|c|}{処理結果(ですますの場合)} ¥¥
¥hline¥hline
１準備して洗濯物を入れる & 12 & × & ×(1) & １準備して洗濯物を入れます ¥¥
¥hline
本体の確認 & 5 & × & ×(2) & 本体の確認をしてください ¥¥
¥hline
●蛇口を開く & 5 & × & ×(2) & ●蛇口を開いてください ¥¥
¥hline
●ふろ水ポンプの準備 & 10 & × & ○ & ●ふろ水ポンプの準備をして、 ¥¥
¥cline{1-3}
洗濯物の準備 & 6 & × & (4-b) & 洗濯物の準備をします ¥¥
¥hline
ドアを開けて洗濯物を入れる & 13 & × & ×(3) & ドアを開けて洗濯物を入れます ¥¥
¥hline
ドアハンドルを引いて開ける & 13 & ○ & ○ & ドアハンドルを引いて開け、 ¥¥
¥cline{1-3}
ドアをしっかり押して閉める & 13 & × & (4-a) & ドアをしっかり押して閉めます ¥¥
¥hline
¥end{tabular}
¥end{center}
¥end{table}

表¥ref{layout2}に文の結合の例を示す．ユーザによる文と画像の選択パターンには様々な種類が考えられるため，文の結合位置もユーザの選択に応じて様々なパターンが存在すると言える．¥¥
　以上の手順により文の数を減らし，1文を1コマと対応付ける．

¥subsubsection{選択された文体への変換}

会話の際の文体には，大きく分けて以下の2種類が考えられる．
¥begin{itemize}
¥setlength{¥itemsep}{-5pt}
¥item ですます(〜です，〜します，〜してください，など)
¥item 話し言葉(〜だよ，〜てね，〜するよ，など)
¥end{itemize}
提案システムでは，ユーザがこれら2種類から漫画のセリフに反映したい文体を選択することを可能にしている．

¥begin{table}[h]
¥begin{center}
¥caption{選択された文体への変換の例}
¥label{str_style}
¥begin{tabular}{|c|c|c|}
¥hline
入力文 & ですます & 話し言葉 ¥¥
¥hline¥hline
¥raisebox{-1.8ex}[0pt][0pt]{洗濯物を入れる} & 洗濯物を入れます & 洗濯物を入れるよ ¥¥
¥cline{2-3}
 & 洗濯物を入れてください & 洗濯物を入れてね ¥¥
¥hline
¥raisebox{-1.8ex}[0pt][0pt]{本体の確認} & 本体の確認をします & 本体の確認をするよ ¥¥
¥cline{2-3}
 & 本体の確認をしてください & 本体の確認をしてね ¥¥
¥hline
お知らせ & お知らせです & お知らせだよ ¥¥
¥hline
お願い & お願いです & お願いだよ ¥¥
¥hline
ご注意 & 注意してください & 注意してね ¥¥
¥hline
表示します & — & 表示するよ ¥¥
¥hline
お知らせです & — & お知らせだよ ¥¥
¥hline
しません & — & しないよ ¥¥
¥hline
ご使用ください & — & 使用してね ¥¥
¥hline
¥end{tabular}
¥end{center}
¥end{table}

表¥ref{str_style}に選択された文体への変換の例を示す．各コマに使用する文のそれぞれに対して構文解析を行い，ユーザの選択した文体への変換を行う．一般に文末の文体が文全体の印象を決定すると考えられるため，処理は文末に対してのみ行う．

¥newpage

¥subsubsection{行単位への分割}

文末処理を行った文に対して吹き出しの行単位への分割を行う．吹き出し内の文の表示は{¥bf 3.4.3}で述べたように1行に8文字×6行あるいは1行に6文字×3行で行うが，単に文を8文字や6文字ずつ区切って表示すると単語の途中で行が変わってしまい読者が読みづらくなってしまう可能性がある．¥¥
　そこで以下に示すルールにしたがって，構文解析の結果と1行の最大文字数の両者を考慮した改行位置の決定を行う．図¥ref{fig:divide1}に行単位への分割処理の流れを示す．

¥begin{figure}[!b]
 ¥begin{center}
  ¥includegraphics[scale=0.7]{./fig/divide1.jpg}
  ¥caption{行単位への分割処理の流れ}
  ¥label{fig:divide1}
 ¥end{center}
¥end{figure}
¥begin{figure}[h]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/divide2.eps}
  ¥caption{行数を減らす処理の流れ}
  ¥label{fig:divide2}
 ¥end{center}
¥end{figure}

この手順で分割処理を行った場合，1行の最大文字数の考慮は行っているが1つの吹き出し内の最大の行数の考慮は行っていない．女の子の吹き出し内の文の表示は最大6行までと定めているが，例えば行単位への分割結果が7要素以上になった場合，文が吹き出しから左右方向にはみ出してしまうことになる．¥¥
　そこで，分割した結果の行数が(1つの吹き出し内の最大行数+1)より多い場合には，行数を減らす処理を行う．図¥ref{fig:divide2}に行数を減らす処理の流れを示す．具体的には，上記の手順で行単位に分割した結果を2文ずつ結合した場合の文字列の長さを調べ2(1つの吹き出し内の最大行数+1)になるまで繰り返す．結合した長さが最小になるものを結合することで，吹き出しからの左右方向へのはみ出しだけでなく上下方向へのはみ出しも同時に防ぐことを狙っている．¥¥
　以上の手順により分割した文を次に生成するコマ画像の上に表示する．

¥subsection{要素の決定}

¥subsubsection{背景画像の選択}

背景画像は，場所画像とパターン画像の2種類のグループから選択される．図¥ref{fig:bg1}に場所画像の一覧を，図¥ref{fig:bg2}にパターン画像の一覧を示す．

¥begin{figure}[tb]
 ¥begin{minipage}{0.5¥hsize}
  ¥begin{center}
   ¥includegraphics[scale=0.6]{./fig/bg1.eps}
  ¥end{center}
  ¥caption{場所画像}
  ¥label{fig:bg1}
 ¥end{minipage}
 ¥begin{minipage}{0.5¥hsize}
  ¥begin{center}
   ¥includegraphics[scale=0.6]{./fig/bg2.eps}
  ¥end{center}
  ¥caption{パターン画像}
  ¥label{fig:bg2}
 ¥end{minipage}
¥end{figure}

背景画像の選択は，システムにより以下の手順で行われる．図¥ref{fig:select_bg}に背景画像の選択手順を示す．
¥begin{enumerate}
¥setlength{¥itemsep}{-5pt}
¥item マニュアル内のキーワードに対応する場所画像を基本画像として選択
¥item パターン画像で置き換えるコマを選択
¥item 2.で選択したコマに応じて各コマに基本画像，またはパターン画像を割り当て
¥end{enumerate}

¥begin{figure}[tb]
 ¥begin{center}
  ¥includegraphics[scale=0.7]{./fig/select_bg.eps}
  ¥caption{背景画像の選択手順}
  ¥label{fig:select_bg}
 ¥end{center}
¥end{figure}

¥begin{table}[h]
¥begin{center}
¥caption{事前に設定したキーワードと場所画像の対応}
¥label{select_bg}
¥begin{tabular}{|c|c|}
¥hline
キーワード & 画像 ¥¥
¥hline¥hline
「冷蔵庫」「レンジ」 & 1、2 ¥¥
¥hline
洗濯 & 3 ¥¥
¥hline
「ファクシミリ」「電話」 & 4〜7 ¥¥
¥hline
「辞書」 & 8 ¥¥
¥hline
その他 & 4〜7 ¥¥
¥hline
¥end{tabular}
¥end{center}
¥end{table}

場所画像としてリビングや個人の部屋，キッチン，お風呂などの画像を用意してあり，マニュアル内に登場すると考えられる「洗濯」「冷蔵庫」などのキーワードを事前に場所画像と対応付けてある．表¥ref{select_bg}にキーワードと場所画像の対応を示す．¥¥
　まず，テキストが事前に設定したキーワードを含む場合，キーワードに対応する場所画像の中からこのマニュアルに対する基本画像がランダムに選択される．例えば「洗濯」というキーワードが含まれる場合，対応するお風呂の画像が基本画像として選択される．また，「冷蔵庫」というキーワードが含まれる場合，対応するキッチンの画像が基本画像として選択される．¥¥
　すべてのコマの背景に基本画像を使用すると漫画が単調になってしまうため，一部のコマの背景をパターン画像で置き換える処理を行う．漫画全体に対して均一に背景の置き換えを行うために，4コマ単位での置き換えを行う．漫画全体を4コマずつ分割して，各4コマに対し1〜2コマをランダムに選択する．そして，選択したコマをランダムに選択したパターン画像で置き換える．置き換えるコマと選択されるパターン画像の組み合わせには多くの種類があるため，この処理によって様々な背景パターンの漫画を生成することが可能である．

¥subsubsection{キャラクターの表情とポーズの選択}

キャラクターの画像はポーズ，表情の順に保存されており，漫画に使用するキャラクターはシステムによってその順にランダムに選択される．表情がキャラクターの顔部分のみを占めるのに対して，ポーズはキャラクターの全身で表現される．つまり，ポーズの方が表情と比べてキャラクターの多くの部分を占めることになる．そのため，キャラクターの印象に対してより大きな影響を与えると考えられるポーズが先に選択され，その後表情の選択が行われる．¥¥
　女の子のキャラクターは，コミPo!に搭載されている14種類のポーズと7種類の表情を組み合わせて411種類のパターンを作成した．また，男の子のキャラクターは，コミPo!に搭載されている7種類のポーズと7種類の表情を組み合わせて230種類のパターンを作成した．

¥subsubsection{吹き出しの選択}

図¥ref{fig:balloon}に吹き出し画像の一覧を示す．吹き出し画像は，コミPo!に搭載されている5種類の形状から選択する．今回は吹き出しの形状の違いによる印象の差はあまりないと考え，選択はランダムに行っている．
¥begin{figure}[h]
 ¥begin{center}
  ¥includegraphics[scale=0.8]{./fig/balloon.eps}
  ¥caption{吹き出し}
  ¥label{fig:balloon}
 ¥end{center}
¥end{figure}

また，それぞ

¥subsubsection{男の子のキャラクターの相槌の選択}

男の子の相槌の文には，テンプレートから選択したものを使用する．テンプレートとして以下の2種類を用意した．続きを促す文のテンプレートとして16種類，納得する文のテンプレートとして19種類の文を作成した．
¥begin{itemize}
¥setlength{¥itemsep}{-5pt}
¥item 続きを促す文のテンプレート(16種類)
¥item 納得する文のテンプレート(19種類)
¥end{itemize}
　2種類のテンプレートを用意したのは，状況に応じて相槌の種類が異なると考えられるためである．会話の相槌には，続きの説明を促す相槌と今までの内容に対して納得する相槌の2種類があると考えられる．そのため，相槌に対応するマニュアルの文が手順のどの辺りに存在しているかを調べることにより相槌を選択するテンプレートの決定を行っている．¥¥
　具体的には次の手順でテンプレートの選択を行う．まず，文に含まれる手順番号を元に対象の文が含まれる最も大きな手順の番号を調べる．それにより，対象の文が1つの手順の途中に存在する場合には続きを促す文を，1つの手順の最後の文である場合には納得する文をそれぞれのテンプレートから選択する．¥¥
　このとき，漫画の中で何度も同じ相槌が出てきてしまうと会話がワンパターン化してしまうと考えられる．そこで，前後の相槌と異なる種類の相槌を選択するようにしている．具体的な方法としては，2つのテンプレートをパターンに応じて5つのグループと8つのグループに分割し，相槌を選択する際には1つ前に選択したグループと異なるグループから選択を行っている．これにより，単純にランダムに選択を行うよりも様々なパターンの相槌が選択できると期待できる．

¥subsection{漫画生成}

¥subsubsection{テキストの縦書き表示}

一般的な日本の漫画の大きな特徴の1つとして，吹き出し内のテキストが縦書きで書かれることが挙げられる．本システムでは，マニュアルを変換する際により漫画らしい形式とするために，吹き出し内のテキストを縦書きで表示する．
¥begin{figure}[!b]
 ¥begin{center}
  ¥includegraphics[scale=0.5]{./fig/vertical.eps}
  ¥caption{テキストの縦書き表示}
  ¥label{fig:vertical}
 ¥end{center}
¥end{figure}

{¥bf 3.4.3}により行単位に分割した文について，コマ画像上に文字を1文字ずつ貼り付けていくことにより文の表示を行う．その際，普通のフォントでは横書きを前提としているため，文字をそのまま縦方向に貼り付けてしまうと記号や小文字などうまく縦書き表示できない文字が出てきてしまう．そこで，本研究では横書きと縦書きで表示位置の異なる文字について文字の回転と平行移動を行い，自然な縦書き表示を実現している．図¥ref{fig:vertical}に縦書き処理の例を示す．この処理により，一般的な日本の漫画表現に近い漫画を生成することが可能となっている．また，文を貼り付ける際には吹き出し内の位置が上下左右中央になるように貼り付け位置の調整を行っている．

¥subsubsection{画像の表示}

最後に，画像が選択されているコマに対して選択された画像の貼り付けを行う．漫画のコマはもともと大きさが小さく，すでにキャラクターや吹き出しが配置されている．そのため，さらにその上に画像を表示すると画像が小さくなり詳細が見えなくなってしまう可能性がある．¥¥
　そこで，1つのコマに貼り付ける画像は1枚のみに限定し，余っているスペースに対して画像を最大限大きく拡大して貼り付ける処理を行っている．
式(¥ref{eq:w1})，式(¥ref{eq:h1})に画像の幅，高さのそれぞれの拡大率$r_{w}$，$r_{h}$の計算式を示す．ここで，$w_{bg}$，$h_{bg}$はそれぞれ背景の幅，高さ，$w_{p}$，$h_{p}$は貼り付ける画像の幅，高さを表す．また，登場人物1人，吹き出し1つと画像1枚のコマにおける$w_{s}$，$h_{s}$はキャラクターと吹き出しの占める領域の幅，高さを，吹き出し1つと画像1枚のコマにおける$w_{s}$，$h_{s}$は吹き出しの占める領域の幅，高さを表す．
¥begin{equation}
¥label{eq:w1}
r_w = (w_{bg}-w_{s}) / w_{p}
¥end{equation}
¥begin{equation}
¥label{eq:h1}
r_h = (h_{bg}-h_{s}) / h_{p}
¥end{equation}

式(¥ref{eq:rate})に実際の画像の拡大率$r_{p}$の計算式を示す．
¥begin{equation}
¥label{eq:rate}
r_{p} = min(r_w, r_h)
¥end{equation}
計算した$r_{w}$，$r_{h}$のうち，小さい方の値を実際の画像の拡大率として採用する．この処理により，他の要素に重なることなく最大限大きく画像を表示し，より読みやすい漫画の生成が可能となっている．

¥subsubsection{漫画画像の生成}

生成したコマから，以下の手順でページ単位の8コマ漫画とすべて1枚の漫画を生成する．
¥begin{enumerate}
¥setlength{¥itemsep}{-5pt}
¥item 4コマずつ組み合わせて4コマ漫画を生成
¥item 生成した4コマ漫画を2枚ずつ組み合わせて8コマ漫画を生成
¥item 生成した8コマ漫画をすべてまとめた1枚の漫画を生成
¥end{enumerate}

手順2で生成した8コマ漫画を1ページとしてシステム上に表示する．ユーザはページ送りをすることで漫画をページ単位で読むことが可能である．また，すべてのコマを1枚にまとめた漫画を生成することにより，漫画の全体の閲覧も可能にしている．
